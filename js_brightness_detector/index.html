<!doctype html>
<html lang="">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css">
  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-min.css">
  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">

  <style>

    img {
      width: 85%;
      margin: 1rem;
      cursor: pointer;
      border: 1px solid #CCC;
      display: block;
      box-sizing: content-box;
      height: 70%;
    }

  </style>
</head>

<body>
  <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->

  <div class="wrapper" style="width:85%;max-width: 40rem;margin: 0 auto;">
    <div class="pure-g">
      <div class="pure-u-1-1">
        <h1>Javascript Brightness detector.</h1>
      </div>
      <div class="pure-g">
        <div class="pure-u-1-1">
          <p>Click on the image to precss</p>
        </div>
        <div class="pure-u-1-1">
          <div class="pure-g">
            <div class="pure-u-1-1 pure-u-sm-1-5">
              <img src="./images/background.jpg">
            </div>
            <div class="pure-u-1-1 pure-u-sm-1-5">
              <img  src="./images/bgi-5.jpg">
            </div>
            <div class="pure-u-1-1 pure-u-sm-1-5">
              <img  src="./images/bgi-8.jpg">
            </div>
            <div class="pure-u-1-1 pure-u-sm-1-5">
              <img  src="./images/bgi-16.jpg">
            </div>
            <div class="pure-u-1-1 pure-u-sm-1-5">
              <img src="./images/bgi-27.jpg">
            </div>
            <div class="pure-u-1-1 pure-u-sm-1-5">
              <img  src="./images/bgi-28.jpg">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script
          src="https://code.jquery.com/jquery-3.4.1.min.js"
          integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
          crossorigin="anonymous"></script>
  <script>

    $(document).ready(function(){
      $("img").click(function(){
        var imgurl = $(this).attr("src");
        GetImageBrightness(imgurl,function (brightness_level) {
          alert("Brightness Level: "+brightness_level);
        });
      })
    })

  function Process() {
    var imgurl = $("input.txtImagUrl").val();
    GetImageBrightness(imgurl,function (brightness_level) {
      alert("Brightness Level: "+brightness_level);
    });
  }

  function GetImageBrightness(imageSrc,callback) {
    var img = document.createElement("img");
    img.src = imageSrc;
    img.style.display = "none";
    document.body.appendChild(img);

    var colorSum = 0;

    img.onload = function() {
      // create il canvas
      var canvas = document.createElement("canvas");
      canvas.width = this.width;
      canvas.height = this.height;

      var ctx = canvas.getContext("2d");
      ctx.drawImage(this,0,0);

      var imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
      var data = imageData.data;
      var r,g,b,avg;

      for(var x = 0, len = data.length; x < len; x+=4) {
        r = data[x];
        g = data[x+1];
        b = data[x+2];

        avg = Math.floor((r+g+b)/3);
        colorSum += avg;
      }

      var brightness = Math.floor(colorSum / (this.width*this.height));
      callback(brightness);
    }
  }


</script>

</body>

</html>
